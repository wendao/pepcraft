## 采样（方法会过时，思想永流传）

首先要讨论的一个问题是我们为什么需要研究采样方法。当我们说给定了一个体系的时候，指的是给定了一个以构象为函数的汉密顿量，也就是当一个体系的每个自由度的坐标确定，体系的能量可以直接算出。而利用统计物理的工具，就可以建立微观物理量到宏观热力学量的联系，这要求我们计算体系在指定系综下的配分函数。具体的公式在这里不展开讨论，总之我们需要做的是对体系的全构象空间进行积分。这个要求在一般情况，尤其是自由度较多时很难做到。好在，我们可以通过重要性采样来得到这个积分相对准确的估计，采样方法可以理解为为了求得所关心物理量在不同约束下概率分布，近而估算平均值而使用的数学方法。当然后面要介绍的分子动力学方法、以及蒙特卡洛方法除了可以计算平均值外，还可以用于模拟分子运动的合理轨迹，加深人们对分子动力学机制的理解。



### 经典力学

最常用的分子模拟框架为分子动力学，原子运动的法则由最小作用量原理给出（后面将会看到此表述和牛顿第二定律等价，并更具有一般性）。

<img src="pics/image-20210429093705581.png" alt="image-20210429093705581" style="zoom:67%;" />

运动的轨迹使S 取极值（一般为极小值）。L 被称为体系的拉格朗日函数，这里直接给出其形式

<img src="pics/image-20210429093815070.png" alt="image-20210429093815070" style="zoom:67%;" />

等式右边第一项为动能，一般用K 表示，它只与速度的大小有关，不随方向变化而变化，这反应了惯性系各向同性的性质；第二项E 为体系的势能函数，只与位置相关。在朗道《力学》教材第一章中，对L 的形式有更加详尽的讨论。

因为S 取极小值， 其变分为0， 即δS = 0； 且两端点坐标固定， 即δq(t1)=δq(t2)=0。由此可以得到拉格朗日方程（为方便，后面角标i 不再出现，向量表示所有粒子的坐标）

<img src="pics/image-20210429094048435.png" alt="image-20210429094048435" style="zoom:67%;" />

将L带入整理则得到牛顿第二定律

<img src="pics/image-20210429094137500.png" alt="image-20210429094137500" style="zoom:67%;" />

这里的q可以不再局限于质点的笛卡尔坐标，而可以是任意的广义坐标，又可称为体系的自由度。在大分子的模拟中，往往使用内坐标会比笛卡尔坐标有更高的采样效率，需要注意的一点是，如果在坐标变换后进行采样，采样的权重需要引入雅克比行列式进行矫正，以保证采样在相空间中分布均匀。

分子动力学模拟中，用数值方法求解给定初始状态的动力学方程，常用Velocity-Verlet算法更新原子速度和坐标

<img src="pics/image-20210429094631198.png" alt="image-20210429094631198" style="zoom:67%;" />

计算公式如下

<img src="pics/image-20210429094723838.png" alt="image-20210429094723838" style="zoom:67%;" />

实际进行分子动力学模拟时还有很多细节如控温控压，约束键长等方法和技巧，但在格子世界里位置都是离散的，我们也用不到这些，这里不再赘述。



### 蒙特卡洛

对于坐标连续且可以求导的问题，分子动力学是比较合适的工具，可以无脑运行，烧脑分析。而很多模型，尤其是高度抽象的理论模型，坐标是离散的且无法求导时（当然连续问题也可以）就需要采用蒙特卡洛模拟方法进行采样。蒙特卡洛方法在统计物理中是非常重要的采样工具，且在使用时有非常多的技巧可以加速，同时也有很多机会容易犯错。在后面的章节我们会介绍一些蒙特卡洛增强采样的方案。



## 模型（aka. 力场）

前面还提到了汉密顿量，也就是对给定构象的体系如何计算能量，模型的准确性是计算成功与否的关键。相对来说采样方法有效率高低之分，但即使是低效的采样，也依然可以得到一些有用的结果，大不了跑久一些。而模型如果错了，采样效率越高，结果越离谱。理论上量子力学是最精确的模型，但原子一多就算不动了，一些近似方案虽然能一定程度缓解，但一方面误差越来越大，一方面可应用的体系还远达不到蛋白质分子的规模。

实际的生物大分子体系，人们往往用分子力学，只考虑原子的笛卡尔坐标自由度，将体系的能量分解为原子原子的相互作用，并用简单的函数拟合两体相互作用，如库伦力、范德华力，以及用谐振势描述化学键的作用。这些近似虽然较为粗糙，但是在近平衡态可以很好的模拟大分子体系的力学和热力学性质，同时利用大量数据进行拟合，并添加“补丁”，力场的准确性也不断提高，常用的有Amber，Charmm，GROMOS，OPLS等。分子动力学方法也已经成为分子生物学研究的标配。对于一些需要考虑电子转移的化学反应，QMMM，也就是关键位置考虑量子力学，其余部分考虑分子力学的联合动力学模拟也是常用的模拟工具。



## 入门书籍

《Understanding Molecular Simulation: From Algorithms to Applications》

中文版《分子模拟从算法到应用》

《Molecular Modelling: Principles and Applications》
